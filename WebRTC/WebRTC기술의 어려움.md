# WebRTC 기술의 어려움

## 네트워크 환경에 따른 품질의 불확실성
웹 환경에서 살고 있는 우리는 사실 매우 신뢰도가 높은 프로토콜인 TCP 기반의 서비스를 주로 경험하고 있기 때문에 네트워크가 얼마나 극도로 예민한 녀석인지 잊어버리곤 합니다. <br>
WebRTC는 UDP 기반의 RTP 프로토콜을 사용하고 있습니다. 품질을 보정하는 기술이 내장되어 있지만, 네트워크 기술에 대한 이해와 충분한 개발 경험이 없다면 WebRTC 기반의 서비스 개발에 성공했다고 안정적인 품질을 보장할 수 없다는 것을 곧 깨닫게 될 것입니다.<br>
더구나 라이브 스트리밍에서 음성 영상 품질을 정량적으로 측정하는 것은 음식의 맛을 절대적 기준으로 정량화하는 것만큼이나 어려운 일입니다. <br>
어떤 청취자는 소리가 작은 것만으로도 품질이 낮아졌다고 평가하며, 어떤 청취자는 적당한 에코에도 품질이 좋다고 생각합니다.<br>
또한 모빌리티 환경의 품질은 갈수록 중요해지고 있는데 반해 모빌리티 환경에서 네트워크의 불안정성은 상상을 초월하는 복잡한 문제입니다. <br>
문제가 발생해도 재현하기 어렵고 논리적인 코드만으로는 상황을 유추하기 어려운 일이 다반사입니다.<br>

 

## 고난이도의 미디어처리 영역
1:1 통화 서비스가 아닌 화상회의나 방송 서비스를 개발하려면 다양한 미디어 처리를 위한 서버들이 필요합니다. <br>
또한 경쟁사들과 차별화를 두기 위해서 화면 꾸미기 같은 특수효과가 필요하기도 합니다. <br>
이러한 기술은 WebRTC와는 무관하지만, 상품성 있는 서비스를 위해서는 반드시 갖춰야 하죠. <br>
보통의 WebRTC 기반 라이브 스트리밍 서비스에서 필요로 하는 미디어 처리 흐름은 그림과 같습니다.<br>


![image](https://user-images.githubusercontent.com/62804036/165524222-2c993dd4-cd90-4d89-bd4c-93f15cb8b802.png)<br>
 WebRTC 기반 라이브 스트리밍 서비스 미디어 처리 흐름<br>
 

'송출'에서 'Origin'에 이르는 부분과 'Edge'에서 '수신'에 이르는 과정만이 WebRTC가 관여하는 부분이고 나머지는 모두 각자의 플랫폼과 각자의 방식으로 구현하거나 감안해야 하는 영역입니다.<br>

 

WebRTC는 클라이언트에서 미디어에 변화를 많이 주고, 서버의 경우 미디어 전송이나 분배에 더 집중하지만, 서버도 녹화나 기본적인 수준의 미디어 처리는 필요할 때가 많습니다. <br>이 때문에 조직 내에 미디어를 자유롭게 다룰 수 있는 엔지니어도 필요하고 모바일 플랫폼의 입출력 미디어 장치에 대한 경험을 가진 엔지니어도 필요합니다.<br>

 

WebRTC를 적극적으로 활용하는 서비스들은 사용자와의 인터랙션을 적극적으로 유도하는 경우가 많습니다. <br>이를 위해서는 영상만 실시간으로 제공되기보단 필수적으로 실시간 채팅과 같은 메시징 인프라가 제공되어야 합니다.  즉, 채팅이나 화면효과 그리고 사용자의 여러 가지 이벤트 등을 실시간으로 전파하고 공유할 수 있는 서버가 꼭 갖춰져야 합니다.<br>

 

## 대용량 처리 및 클라우드
WebRTC 미디어 서버는 WebRTC 기반의 미디어 스트림을 중개 및 분배하는 역할을 하는 서버입니다.<br>
WebRTC 기반의 방송과 화상회의형 서비스는 이 미디어 서버가 꼭 필요합니다. <br>
Janus나 Pion등과 같이 유명한 오픈소스가 존재하여 비교적 쉽게 데모 수준의 서비스를 구현해볼 수 있습니다.<br>

 

미디어 서버 덕분에 1:N이나 N:N 방식의 서비스를 구현할 수는 있지만 문제는 서비스 오픈 이후에 있습니다. <br>
즉 대용량 처리를 위한 적절한 아키텍처를 고민해야 합니다. <br>
WebRTC 기반 서비스들은 한번 방송에 몇십만 명이 시청하는 서비스보다는 클럽하우스나 아프리카TV처럼 다수의 방송이 독립적으로 존재하고 적게는 2-4명 많게는 몇천 명이 대화하는 서비스가 주를 이룹니다. <br>
따라서 개별 방에 대한 트랜잭션을 미리 예측하거나 대응하기보다는 확장성(Scalability)을 매우 유연하게 제어하고 자동화하는 방식을 고민해야 합니다.<br>

 

하지만 우리가 많이 쓰고 있는 AWS(Amazon Web Service)나 GCP(Google Cloud Platform) 혹은 카카오 i 클라우드와 같은 클라우드 서비스등을 WebRTC 미디어 서버에 적합하게 아키텍처를 구성하기는 여의치 않습니다. <br>
적지 않은 부분부터 새롭게 고민해야 합니다. 더구나 미디어 서버를 클라우드 서비스에 적합하게 구성한다는 것은 매우 큰 도전과제 중 하나입니다.<br>



출처: https://tech.kakaoenterprise.com/121 [카카오엔터프라이즈 기술블로그 Tech&(테크앤)]
